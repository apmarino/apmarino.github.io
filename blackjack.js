
console.log("LINKED UP!");

var newDeck ={

  "0": {
    "value": 2,
    "name": "2",
    "suit": "spades",
    "imgUrl": "cards/2_of_spades.png"
  },
  "1": {
    "value": 3,
    "name": "3",
    "suit": "spades",
    "imgUrl": "cards/3_of_spades.png"
  },
  "2": {
    "value": 4,
    "name": "4",
    "suit": "spades",
    "imgUrl": "cards/4_of_spades.png"
  },
  "3": {
    "value": 5,
    "name": "5",
    "suit": "spades",
    "imgUrl": "cards/5_of_spades.png"
  },
  "4": {
    "value": 6,
    "name": "6",
    "suit": "spades",
    "imgUrl": "cards/6_of_spades.png"
  },
  "5": {
    "value": 7,
    "name": "7",
    "suit": "spades",
    "imgUrl": "cards/7_of_spades.png"
  },
  "6": {
    "value": 8,
    "name": "8",
    "suit": "spades",
    "imgUrl": "cards/8_of_spades.png"
  },
  "7": {
    "value": 9,
    "name": "9",
    "suit": "spades",
    "imgUrl": "cards/9_of_spades.png"
  },
  "8": {
    "value": 10,
    "name": "10",
    "suit": "spades",
    "imgUrl": "cards/10_of_spades.png"
  },
  "9": {
    "value": 10,
    "name": "Jack",
    "suit": "spades",
    "imgUrl": "cards/jack_of_spades.png"
  },
  "10": {
    "value": 10,
    "name": "Queen",
    "suit": "spades",
    "imgUrl": "cards/queen_of_spades.png"
  },
  "11": {
    "value": 10,
    "name": "King",
    "suit": "spades",
    "imgUrl": "cards/king_of_spades.png"
  },
  "12": {
    "value": 11,
    "name": "Ace",
    "suit": "spades",
    "imgUrl": "cards/ace_of_spades.png"
  },
  "13": {
    "value": 2,
    "name": "2",
    "suit": "clubs",
    "imgUrl": "cards/2_of_clubs.png"
  },
  "14": {
    "value": 3,
    "name": "3",
    "suit": "clubs",
    "imgUrl": "cards/3_of_clubs.png"
  },
  "15": {
    "value": 4,
    "name": "4",
    "suit": "clubs",
    "imgUrl": "cards/4_of_clubs.png"
  },
  "16": {
    "value": 5,
    "name": "5",
    "suit": "clubs",
    "imgUrl": "cards/5_of_clubs.png"
  },
  "17": {
    "value": 6,
    "name": "6",
    "suit": "clubs",
    "imgUrl": "cards/6_of_clubs.png"
  },
  "18": {
    "value": 7,
    "name": "7",
    "suit": "clubs",
    "imgUrl": "cards/7_of_clubs.png"
  },
  "19": {
    "value": 8,
    "name": "8",
    "suit": "clubs",
    "imgUrl": "cards/8_of_clubs.png"
  },
  "20": {
    "value": 9,
    "name": "9",
    "suit": "clubs",
    "imgUrl": "cards/9_of_clubs.png"
  },
  "21": {
    "value": 10,
    "name": "10",
    "suit": "clubs",
    "imgUrl": "cards/10_of_clubs.png"
  },
  "22": {
    "value": 10,
    "name": "Jack",
    "suit": "clubs",
    "imgUrl": "cards/jack_of_clubs.png"
  },
  "23": {
    "value": 10,
    "name": "Queen",
    "suit": "clubs",
    "imgUrl": "cards/queen_of_clubs.png"
  },
  "24": {
    "value": 10,
    "name": "King",
    "suit": "clubs",
    "imgUrl": "cards/king_of_clubs.png"
  },
  "25": {
    "value": 11,
    "name": "Ace",
    "suit": "clubs",
    "imgUrl": "cards/ace_of_clubs.png"
  },
  "26": {
    "value": 2,
    "name": "2",
    "suit": "diamonds",
    "imgUrl": "cards/2_of_diamonds.png"
  },
  "27": {
    "value": 3,
    "name": "3",
    "suit": "diamonds",
    "imgUrl": "cards/3_of_diamonds.png"
  },
  "28": {
    "value": 4,
    "name": "4",
    "suit": "diamonds",
    "imgUrl": "cards/4_of_diamonds.png"
  },
  "29": {
    "value": 5,
    "name": "5",
    "suit": "diamonds",
    "imgUrl": "cards/5_of_diamonds.png"
  },
  "30": {
    "value": 6,
    "name": "6",
    "suit": "diamonds",
    "imgUrl": "cards/6_of_diamonds.png"
  },
  "31": {
    "value": 7,
    "name": "7",
    "suit": "diamonds",
    "imgUrl": "cards/7_of_diamonds.png"
  },
  "32": {
    "value": 8,
    "name": "8",
    "suit": "diamonds",
    "imgUrl": "cards/8_of_diamonds.png"
  },
  "33": {
    "value": 9,
    "name": "9",
    "suit": "diamonds",
    "imgUrl": "cards/9_of_diamonds.png"
  },
  "34": {
    "value": 10,
    "name": "10",
    "suit": "diamonds",
    "imgUrl": "cards/10_of_diamonds.png"
  },
  "35": {
    "value": 10,
    "name": "Jack",
    "suit": "diamonds",
    "imgUrl": "cards/jack_of_diamonds.png"
  },
  "36": {
    "value": 10,
    "name": "Queen",
    "suit": "diamonds",
    "imgUrl": "cards/queen_of_diamonds.png"
  },
  "37": {
    "value": 10,
    "name": "King",
    "suit": "diamonds",
    "imgUrl": "cards/king_of_diamonds.png"
  },
  "38": {
    "value": 11,
    "name": "Ace",
    "suit": "diamonds",
    "imgUrl": "cards/ace_of_diamonds.png"
  },
  "39": {
    "value": 2,
    "name": "2",
    "suit": "hearts",
    "imgUrl": "cards/2_of_hearts.png"
  },
  "40": {
    "value": 3,
    "name": "3",
    "suit": "hearts",
    "imgUrl": "cards/3_of_hearts.png"
  },
  "41": {
    "value": 4,
    "name": "4",
    "suit": "hearts",
    "imgUrl": "cards/4_of_hearts.png"
  },
  "42": {
    "value": 5,
    "name": "5",
    "suit": "hearts",
    "imgUrl": "cards/5_of_hearts.png"
  },
  "43": {
    "value": 6,
    "name": "6",
    "suit": "hearts",
    "imgUrl": "cards/6_of_hearts.png"
  },
  "44": {
    "value": 7,
    "name": "7",
    "suit": "hearts",
    "imgUrl": "cards/7_of_hearts.png"
  },
  "45": {
    "value": 8,
    "name": "8",
    "suit": "hearts",
    "imgUrl": "cards/8_of_hearts.png"
  },
  "46": {
    "value": 9,
    "name": "9",
    "suit": "hearts",
    "imgUrl": "cards/9_of_hearts.png"
  },
  "47": {
    "value": 10,
    "name": "10",
    "suit": "hearts",
    "imgUrl": "cards/10_of_hearts.png"
  },
  "48": {
    "value": 10,
    "name": "Jack",
    "suit": "hearts",
    "imgUrl": "cards/jack_of_hearts.png"
  },
  "49": {
    "value": 10,
    "name": "Queen",
    "suit": "hearts",
    "imgUrl": "cards/queen_of_hearts.png"
  },
  "50": {
    "value": 10,
    "name": "King",
    "suit": "hearts",
    "imgUrl": "cards/king_of_hearts.png"
  },
  "51": {
    "value": 11,
    "name": "Ace",
    "suit": "hearts",
    "imgUrl": "cards/ace_of_hearts.png"
  },
};

var playerHand = [];
var computerHand = [];
var cardsAlreadyDrawn = [];
var gameOver = false;

var drawACard = function (array){ //this function needs an empty array arg to push to(player hand and computer hand)
  var randomNum = Math.floor(Math.random() * 52);
  // debugger;
  if (cardsAlreadyDrawn.indexOf(randomNum) === -1) { //prevents drawing same card
    array.push(newDeck[randomNum.toString()]);
    cardsAlreadyDrawn.push(randomNum);
  } else if (cardsAlreadyDrawn.length === 52) {
    cardsAlreadyDrawn = [];
    drawACard(array);
  } else{
    var newRandomNum = Math.floor(Math.random() * 52);
    array.push(newDeck[newRandomNum.toString()]);
    cardsAlreadyDrawn.push(newRandomNum); 
  };
};

var getHandValue = function(array){ // array needs to be playerHand or computerHand
  var total = 0;
  for(var i = 0; i<array.length; i++){
    total += array[i].value;
  };

  for (var i = 0; i<playerHand.length; i++){
    if (playerHand[i].name === "Ace" && total > 21) {
      total -= 10;
    } else {};
  };
  return total;
};

var displayPlayerCards = function(element, index){
  var $img = $('<img>');
  $img.attr("src", element.imgUrl);
  $img.addClass("pCards pCard"+index);
  $('.player-hand').append($img);
  // $('.player-value').append(element.name + " of " + element.suit +", ");
};
var displayDealerCards = function(element, index){
  var $img = $('<img>');
  $img.attr("src", element.imgUrl);
  $img.addClass("cCards cCard"+index);
  $('.computer-hand').append($img);
  // $('.computer-value').append(element.name + " of " + element.suit +", ");
};
var playerWins = function(){
 var $currentBet = parseInt($('.current-bet').text());
 var $bankTotal = parseInt($('.bank').text());
 $('.bank').text($bankTotal + 2*$currentBet);
 $('.current-bet').text("");
 $('.cCard0').attr("src", computerHand[0].imgUrl);
 $('.middle').append("<h5>YOU WIN</h5>");
 debugger;
};
var blackJack = function(){
 var $currentBet = parseInt($('.current-bet').text());
 var $bankTotal = parseInt($('.bank').text());
 $('.bank').text($bankTotal + 2*$currentBet);
 $('.current-bet').text("");
 $('.cCard0').attr("src", computerHand[0].imgUrl);
 $('.middle').append("<h5>BLACKJACK\!</h5>");
 debugger;
};
var itsADraw = function(){
  var $currentBet = parseInt($('.current-bet').text());
  var $bankTotal = parseInt($('.bank').text());
  debugger;
  $('.bank').text($bankTotal + $currentBet);
  $('.current-bet').text("");
  $('.cCard0').attr("src", computerHand[0].imgUrl);
  $('.middle').append("<h5>PUSH</h5>");
};

var dealerWins = function(){
  $('.current-bet').text("");
  console.log('dealer won');
  $('.cCard0').attr("src", computerHand[0].imgUrl);
  if (parseInt($('.bank').text()) <= 0) {
  gameOver = true;
  $('#modal').show();
 };
 $('.middle').append("<h5>DEALER WINS</h5>");
 debugger;
};

var newDeal = function(){
  cardsAlreadyDrawn = [];
  drawACard(playerHand);
  drawACard(playerHand);
  drawACard(computerHand);
  drawACard(computerHand);
};

var doubledown = function(){

  drawACard(playerHand);
  $('.pCards').remove();
  playerHand.forEach(displayPlayerCards);
  var $currentBet = parseInt($('.current-bet').text());
  var $bankTotal = parseInt($('.bank').text());
  $('.current-bet').text(2*$currentBet);
  $('.bank').text($bankTotal - $currentBet);
  debugger;
  dealersTurn();
};

var startClick = function(){
  if ($('.current-bet').text().length <= 0 || typeof(parseInt($('.current-bet').text())) !== "number") {
    alert("Input a number!");
  } else{
    $('.middle').html("");
    newDeal();
    //drawing cards for plater and computer
    $('.stay').toggle();
    
    var playerValue = getHandValue(playerHand);
    var computerValue = getHandValue(computerHand);
    $('.pCards').remove();
    playerHand.forEach(displayPlayerCards);
    // $('.player-value').append(" Total:" + playerValue);

    $('.cCards').remove();
    computerHand.forEach(displayDealerCards);
    $('.cCard0').attr("src", "cards/black_joker.png");
    // $('.computer-value').append(" Total:" + computerValue);
   
    $('.start').off('click').on('click', hitClick).text("hit");

    $('.doubledown').show();
    $('.doubledown').on('click', doubledown);    
  };
};
  
var hitClick = function(){
  drawACard(playerHand);
  var playerValue = getHandValue(playerHand);
  console.log(playerValue);
  // $('.player-value').text("");
  $('.pCards').remove();
  playerHand.forEach(displayPlayerCards);
  // $('.player-value').append(" Total:" + playerValue);

  // $('.start').off('click').on('click', startClick);
};

var whoWon = function(){
  var playerValue = getHandValue(playerHand);
  var computerValue = getHandValue(computerHand);
  debugger;
  if (playerValue > 21 && computerValue > 21) {
    debugger;
    itsADraw();
  } else if (playerValue > 21) {
    $('.middle').append("<h5>YOU BUST</h5>");
    dealerWins();
    debugger;
  } else if ( computerValue > 21) {
    $('.middle').append("<h5>DEALER BUST</h5>");
    playerWins();
    debugger;
  } else if (playerValue === 21) {
    blackJack();
    debugger;
  } else if ( playerValue > computerValue) {
    playerWins();
    debugger;
  } else if (computerValue > playerValue) {
    dealerWins();
    debugger;
  } else if (playerValue === computerValue) {
    itsADraw();
    debugger;
  };

  $('.start').off('click').on('click', startClick).text('Deal');
  $('.stay').toggle();
  $('.doubledown').hide();
  playerHand = [];
  computerHand = [];
};
var dealersTurn = function(){
  var playerValue = getHandValue(playerHand);
  var computerValue = getHandValue(computerHand);
  debugger;
  if (computerValue >= 17) {
    whoWon();
    debugger;
  } else{
    drawACard(computerHand);
    computerValue = getHandValue(computerHand);
    // $('.computer-value').text("");
    $('.cCards').remove();
    computerHand.forEach(displayDealerCards);
    // $('.computer-value').append(" Total:" + computerValue);
    console.log("computer value:", computerValue);
    debugger;
    if (computerValue>=17) {
      debugger;
      whoWon();
    } else {
      debugger;
        dealersTurn();    
      };
  }
};

$(document).ready(function(){


$('.bet').on('click', function(){
  var bankTotal = parseInt($('.bank').text());
  var bet = parseInt($('.input-bet').val());
  if (bet > bankTotal) {
    alert("Your bet must be lower than your Bank.");
  } else{
  $('.bank').text(bankTotal - bet);
  $('.current-bet').text(bet);
  console.log("bankTotal: ", bankTotal, "bet: ", bet)
  };
});



$('.stay').on('click', function(){
  var playerValue = getHandValue(playerHand);
  var computerValue = getHandValue(computerHand);
  // console.log("player value: ");
  dealersTurn();
});

$(".start").on('click', startClick);
$(".modal-button").on('click', function(){
  window.location.reload();
  console.log("modal clicked");
});

});





